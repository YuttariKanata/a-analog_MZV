<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>a-analog MZV Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>a-analog Multiple Zeta Value Calculator</h1>
    <div id="inputs" class="spinner">
        <!-- 24個の入力欄 -->
        <label for="input0">k1 :</label>
        <input type="number" id="input0" min="0" value="2"><br>
        <label for="input0">k2 :</label>
        <input type="number" id="input1" min="0" value="3"><br>
        <label for="input0">k3 :</label>
        <input type="number" id="input2" min="0" value="0"><br>
        <label for="input0">k4 :</label>
        <input type="number" id="input3" min="0" value="0"><br>
        <label for="input0">k5 :</label>
        <input type="number" id="input4" min="0" value="0"><br>
        <label for="input0">k6 :</label>
        <input type="number" id="input5" min="0" value="0"><br>
        <label for="input0">k7 :</label>
        <input type="number" id="input6" min="0" value="0"><br>
        <label for="input0">k8 :</label>
        <input type="number" id="input7" min="0" value="0"><br>
        <label for="input0">k9 :</label>
        <input type="number" id="input8" min="0" value="0"><br>
        <label for="input0">k10:</label>
        <input type="number" id="input9" min="0" value="0"><br>
        
        <label for="input0">e1 :</label>
        <input type="number" id="input10" value="0"><br>
        <label for="input0">e2 :</label>
        <input type="number" id="input11" value="-1"><br>
        <label for="input0">e3 :</label>
        <input type="number" id="input12" value="0"><br>
        <label for="input0">e4 :</label>
        <input type="number" id="input13" value="0"><br>
        <label for="input0">e5 :</label>
        <input type="number" id="input14" value="0"><br>
        <label for="input0">e6 :</label>
        <input type="number" id="input15" value="0"><br>
        <label for="input0">e7 :</label>
        <input type="number" id="input16" value="0"><br>
        <label for="input0">e8 :</label>
        <input type="number" id="input17" value="0"><br>
        <label for="input0">e9 :</label>
        <input type="number" id="input18" value="0"><br>
        <label for="input0">e10:</label>
        <input type="number" id="input19" value="0"><br>

        <label for="input0">iterations:</label>
        <input type="number" id="input20" min="5" value="1000000"><br>
        <label for="input0"><span class="thin-space2"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ThinSpace;a:</label>
        <input type="number" id="input21" value="1"> /
        <input type="number" id="input22" value="2"><br>
        <label for="input0"><span class="thin-space1"></span>precision:</label>
        <input type="number" id="input23" min="20" value="200"><br>
    </div>

    <div id="result1"></div>
    <div id="result2"></div>
    <div class="spinner">
        <button onclick="pressBtn()">Calculate</button>
    </div>
    <p>aは分数で入力してね<br>
    ε算法を使っているのでiterationsを2^n+2の形で入力すると精度がよくなります(は？)<br>
    2^18+2= 262146 , 2^19+2= 524290 , 2^20+2= 1048578 , 2^21+2= 2097154 , 2^22+2= 4194306 , 2^23+2= 8388610<br>
    ここら辺の値が参考です。下に表を書いておきます<br>
    精度の保証はしませんが、epsilon Result:と書かれたものは(多分めちゃくちゃ)精度がいいはずです <br>
    epsilon Result:の精度の確認方法として、精度を一段階ずつ上げて行って収束の具合を確認するというものがあります(保証はない)<br>
    大きすぎる値で何回も計算するとメモリ不足で止まる可能性があるので、その時はリロードしてください<br>
    ていうか一回計算するごとにリロードしてください<br>
    precisionは10進数での精度です<br>
    前の計算機:<a href="https://yuttarikanata.github.io/yk495.github.io/">https://yuttarikanata.github.io/yk495.github.io/</a><br>
    作者はメモリ管理をよく把握してないです。怖いので適度にリロードしましょう。<br>
    それでも怖いのでブラウザを閉じましょう。<br>
    それでも怖い?ならpcを再起動しましょう<br>
    メモリが足りない？もっと計算したい？作者に怒鳴りつけましょう<br>
    Twitter(X)のアカウント:<a href="https://twitter.com/eyV6a3AdWcAoZhY">@eyV6a3AdWcAoZhY</a><br>
    元のC言語で書かれたプログラムが欲しい？作者に怒鳴りつけましょう。<br>
    それか、GitHubでもいいかもしれません<br>
    GitHub:<a href="https://github.com/YuttariKanata">https://github.com/YuttariKanata</a><br>
    どうやってこんなに高速に計算してるか分からない？作者に怒鳴りつけましょう。<br>
    それか、Mathlogで怒鳴りつけてもいいかもしれませんね<br>
    作者のMathlog:<a href="https://mathlog.info/users/lXPsXdHEzQViJHdnC7jkXrwtwM33">https://mathlog.info/users/lXPsXdHEzQViJHdnC7jkXrwtwM33</a><br>
    ああ、あと作者は 数値計算bot というbotを手動で運営しています。(botとは？)<br>
    もし数値計算がしたかったら力になれるかもしれません。TwitterのDMで怒鳴りつけましょう。<a href="https://twitter.com/suutikeisan_bot">@suutikeisan_bot</a></p>
    <table border="2">
        <tr>
            <td>n</td>
            <td>2^n+2</td>
        </tr>
        <tr>
            <td>1</td>
            <td>4</td>
        </tr>
        <tr>
            <td>2</td>
            <td>6</td>
        </tr>
        <tr>
            <td>3</td>
            <td>10</td>
        </tr>
        <tr>
            <td>4</td>
            <td>18</td>
        </tr>
        <tr>
            <td>5</td>
            <td>34</td>
        </tr>
        <tr>
            <td>6</td>
            <td>66</td>
        </tr>
        <tr>
            <td>7</td>
            <td>130</td>
        </tr>
        <tr>
            <td>8</td>
            <td>258</td>
        </tr>
        <tr>
            <td>9</td>
            <td>514</td>
        </tr>
        <tr>
            <td>10</td>
            <td>1026</td>
        </tr>
        <tr>
            <td>11</td>
            <td>2050</td>
        </tr>
        <tr>
            <td>12</td>
            <td>4098</td>
        </tr>
        <tr>
            <td>13</td>
            <td>8194</td>
        </tr>
        <tr>
            <td>14</td>
            <td>16386</td>
        </tr>
        <tr>
            <td>15</td>
            <td>32770</td>
        </tr>
        <tr>
            <td>16</td>
            <td>65538</td>
        </tr>
        <tr>
            <td>17</td>
            <td>131074</td>
        </tr>
        <tr>
            <td>18</td>
            <td>262146</td>
        </tr>
        <tr>
            <td>19</td>
            <td>524290</td>
        </tr>
        <tr>
            <td>20</td>
            <td>1048578</td>
        </tr>
        <tr>
            <td>21</td>
            <td>2097154</td>
        </tr>
        <tr>
            <td>22</td>
            <td>4194306</td>
        </tr>
        <tr>
            <td>23</td>
            <td>8388610</td>
        </tr>
        <tr>
            <td>24</td>
            <td>16777218</td>
        </tr>
        <tr>
            <td>25</td>
            <td>33554434</td>
        </tr>
        <tr>
            <td>26</td>
            <td>67108866</td>
        </tr>
        <tr>
            <td>27</td>
            <td>134217730</td>
        </tr>
        <tr>
            <td>28</td>
            <td>268435458</td>
        </tr>
        <tr>
            <td>29</td>
            <td>536870914</td>
        </tr>
        <tr>
            <td>30</td>
            <td>1073741826</td>
        </tr>
    </table>   
    <script src="Azeta.js"></script>
    <script>
        var azeta = Module.cwrap("azeta", "number", ["number", "number"]);

        function pressBtn(){
            var input_array = new Int32Array(34);

            // 各入力欄の値を取得し、Int32Arrayに設定
            //k_index [4]-[13]
            for (var i = 0; i <= 9; i++) {
                var inputValue = parseInt(document.getElementById("input" + i).value);
                input_array[i+4] = inputValue;
            }
            //e_index [14]-[23] & e_index sign [24]-[33]
            for (var i = 10; i <= 19; i++) {
                var inputValue = parseInt(document.getElementById("input" + i).value);
                console.log(i," is ",inputValue);
                input_array[i+4] = Math.abs(inputValue);
                if (Number(inputValue) >= 0){
                    input_array[i+14] = 0;
                } else {
                    input_array[i+14] = 1;
                }
            }
            input_array[0] = parseInt(document.getElementById("input23").value);//  [0]:精度(decimal)
            input_array[1] = parseInt(document.getElementById("input20").value);//  [1]:上限
            input_array[2] = parseInt(document.getElementById("input21").value);//  [2]/[3]:a
            input_array[3] = parseInt(document.getElementById("input22").value);
            console.log("The starting array is:", input_array);

            var input_len = input_array.length;
            var output_len = Math.round(5+2*input_array[0]);   //詳細はazeta.cのstr_value
            var bytes_per_element = input_array.BYTES_PER_ELEMENT;

            console.log("bytes per element:",bytes_per_element);
            console.log("input_len:",input_len);
            console.log("output_len:",output_len);
            
            var input_ptr = Module._malloc(input_len * bytes_per_element);
            var output_ptr = Module._malloc(output_len * bytes_per_element);
            
            Module.HEAP32.set(input_array, input_ptr / bytes_per_element);
            var expis = azeta(input_ptr, output_ptr);
            var output_array = new Int32Array(Module.HEAP32.buffer, output_ptr, output_len);
            console.log("output_array:",output_array);
            

            // 11が最初に現れるインデックスを見つける
            var splitIndex = output_array.indexOf(11);

            if (splitIndex !== -1) {
                // 前半部分を output_array1 に格納（11は含めない）
                var output_array1 = output_array.slice(2, splitIndex);
                
                // 後半部分を output_array2 に格納（11は含めない）
                var output_array2 = output_array.slice(splitIndex + 1);
                
                console.log("output_array1:", output_array1);
                console.log("output_array2:", output_array2);
            } else {
                console.log("11が見つかりませんでした。");
            }

            
            console.log("The starting array was:", input_array);
            console.log("The result read is:", output_array);
            console.log("The exp is:", expis);

            var resultDiv = document.getElementById("result1");

            expis = output_array[0];
            if (expis % 2 == 0) {
                expis = expis/2;
            }else{
                expis = (1-expis)/2;
            }
            

            if(Number(expis) < 0){
                answer_array = Int32Array(output_array1.length - expis);
                add_array = Int32Array(-expis);
                answer_array.set(add_array,0);
                answer_array.set(output_array1,add_array.length);

                answerString = answer_array.join('');
                formattedString = '0.' + answerString;

                resultDiv.textContent = "Result: " + formattedString;
            }else if(Number(expis) == 0){
                answerString = output_array1.join('');
                formattedString = '0.' + answerString;

                resultDiv.textContent = "Result: " + formattedString;
            }else if(Number(expis) > 0){
                substring1 = output_array1.slice(0, expis);
                substring2 = output_array1.slice(expis);
                answerString = substring1.join('') + '.' +substring2.join('');

                formattedString = answerString;

                resultDiv.textContent = "Result: " + formattedString;
            }
            

            var resultDiv = document.getElementById("result2");

            expis = output_array[1];
            if (expis % 2 == 0) {
                expis = expis/2;
            }else{
                expis = (1-expis)/2;
            }

            var answerString;
            var formattedString;
            if(Number(expis) < 0){
                var answer_array = new Int32Array(output_array2.length - expis);
                var add_array = new Int32Array(-expis);
                answer_array.set(add_array,0);
                answer_array.set(output_array2,add_array.length);

                answerString = answer_array.join('');
                formattedString = '0.' + answerString;

                resultDiv.textContent = "epsilon Result: " + formattedString;
            }else if(Number(expis) == 0){
                answerString = output_array2.join('');
                formattedString = '0.' + answerString;

                resultDiv.textContent = "epsilon Result: " + formattedString;
            }else if(Number(expis) > 0){
                var substring1 = output_array2.slice(0, expis);
                var substring2 = output_array2.slice(expis);
                answerString = substring1.join('') + '.' +substring2.join('');

                formattedString = answerString;

                resultDiv.textContent = "epsilon Result: " + formattedString;
            }

            Module._free(input_ptr);
            Module._free(output_ptr);
        }
    </script>
</body>
</html>